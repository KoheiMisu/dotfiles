# peco --------
export HISTCONTROL="ignoredups"
peco-history() {
  local NUM=$(history | wc -l)
  local FIRST=$((-1*(NUM-1)))

  if [ $FIRST -eq 0 ] ; then
    history -d $((HISTCMD-1))
    echo "No history" >&2
    return
  fi
  local CMD=$(fc -l $FIRST | sort -k 2 -k 1nr | uniq -f 1 | sort -nr | sed -E 's/^[0-9]+[[:blank:]]+//' | peco | head -n 1)
  if [ -n "$CMD" ] ; then
    history -s $CMD
    if type osascript > /dev/null 2>&1 ; then
      (osascript -e 'tell application "System Events" to keystroke (ASCII character 30)' &)
    fi

    # Uncomment below to execute it here directly
    echo $CMD >&2
    eval $CMD
  else
    history -d $((HISTCMD-1))
  fi
}
bind -x '"\C-h": peco-history'

peco-kill(){
  local PROC=`ps aux | peco`
  local PID=`echo "$PROC" | awk '{print $2}'`
  if [ -n "$PID" ];then
    echo "kill pid:$PID. [$PROC]"
    kill $PID
  fi
}
bind -x '"\C-k":peco-kill'

function peco-cd {
	cd $(ghq list -p | peco)
}
alias sd='peco-cd'

# !peco --------

